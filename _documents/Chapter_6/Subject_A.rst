=============================
课题A：配置网络安全技术
=============================

如果不先了解实现网络功能的设备和技术，就无法充分保护网络。在本章课程中，您将配置可能会使用的网络设备和技术，以便在组织中实现安全性。

网络组件
------------------

下表描述了组成网络的集中常见组件。

.. csv-table:: 网络组件
    :header: "网络组件", "描述"
    :widths: 5 30

    "设备（Device）", "计算机、服务器、打印机或智能手机等任何硬件。"
    "媒介（Media）", "将设备连接到网络并在设备之间传输数据。"
    "网络适配器（Network adapter）", "在网络和设备之间转换数据的硬件。"
    "网络操作系统（Network oprating system）", "控制网络流量和访问网络资源的软件。"
    "协议（Protocol）", "使用一组规则来控制网络通讯的软件。"

网络设备
-----------------

不同类型的网络设备在网络连接和网络段之间提供不同级别的连接和安全性。以下是常用网络设备的列表：

* 路由器
* 交换机
* 代理
* 防火墙
* 负载均衡器

路由器
--------------

路由器（router）是连接多个使用相同协议网络的设备。路由器可以检查网络数据包中基于协议的寻址信息，并确定最有效的数据路径。大多数路由器不会转发广播网络流量。

说到安全性，路由器可以通过使用访问控制列表[access control list(ACL)]来过滤网络流量并实施反欺诈措施。这种ACL可以从未知恶意、已知恶意或疑似恶意的源中删除网络数据包。例如，面向互联网的路由器不应接收来自任何私有IP地址（例如，192.168.0.0至192.168.255.255）范围的入站流量。任何来自这种源的流量很可能被攻击者做手脚，因此可以配置路由器自动丢弃这些网络连接。

交换机
---------------

网络交换机（switch）是一种具有多个网络端口并将多个物理网段组合成为一个逻辑网络的设备。通过创建专用的或交换的连接，其中仅包含传输中涉及的两个主机，这样就能控制逻辑网络上的网络流量。

标准交换机通常将广播转发到交换机上的所有端口，但会根据分配给内每个网络适配器的唯一物理地址（也称为第2层功能）将单独的数据包发送到特定目标主机。一些交换机可以根据协议地址执行路由功能（也称为第3层功能）。

网络交换机提供的一些安全保护包括：

* 交换机可以通过限制允许在特定端口上接收通信的唯一硬件来实现端口安全。例如，如果交换机具有特定端口上的可接受介质访问控制（MAC）地址白名单，则任何MAC地址不在列表中的设备都将被拒绝通讯。
* 交换机也可能具有防洪（flood guard）功能，保护交换机上的主机免受SYN泛洪和ping泛洪的DoS攻击。
* 交换机也可以实现环路预防。当互联连接的多个交换机无期限地来回反弹流量时，会出现网络环路（network loop）。这可能会对流量产生乘数效应，导致出现DoS状况。环路保护功能可能检测环路并关闭检测到环路的端口上的网络访问。

.. note:: 生成树协议（STP）能预防网络环路，并且可以在交换机和网桥上运行。

网桥
^^^^^^^^^^^^^^^

一种类似于交换机的网络设备是网桥（bridge）。主要区别在于网桥有一个单一端口用于入站流量，另一个单一端口用于出站流量。网桥对于高速和高负载网络来说不太理想。

代理
-------------

代理（proxy）是在网络连接内，与连接的一端进行通讯时，充当网络连接另一端的设备。代理经常用作内容过滤的一种方法。

在典型的代理中，也称为转发代理，客户端必须通过代理才能连接到外部网络。例如，如果用户想要联系互联网上的一个服务器，这是位于企业网络之外的一个服务器，那么组织就可以强制其用户通过转发代理进行连接。代理根据组织设置的各种因素允许或阻止用户的流量。代理服务器还可以修改用户的流量（不透明）或不修改直接转发流量（透明）。

另一方面，反向代理代表客户端正在联系的服务器。客户端的流量不是直接到达Web服务器，而是会被反向代理拦截，然后将其转发到Web服务器。与正向代理一样，反向代理也可以在流量到达目的地之前阻止或修改流量。这旨在保护目标服务器免受危害。

一些代理是多用途的，并且对通过它们的流量拥有应用程序级别的认识。这样的代理可以根据流量的性质做出决定，例如将IPv4流量转换为IPv6。

防火墙
---------------

防火墙（firewall）是指通过阻止不必要的网络流量来保护系统或网络的任何软件或硬件设备。防火墙一般被配置为通过一个被称为隐式拒绝（implicit deny）的进程阻止可疑或未经请求的入站流量，除了防火墙明确允许的流量（即白名单）之外，所有入站流量都会默认阻止。与此同时，防火墙允许大多数类型的出站流量。通过防火墙阻止或允许的流量类型使用预定义的规则集进行配置。有关入站或出站连接的信息可以保存到日志中，并用于网络监控或加固目的。

有三种常见类型的防火墙：

1. 基于主机的防火墙安装在一台计算机上，用于保护大多数家庭计算机。
2. 基于网络的防火墙（Network-based firewall）是一种专用硬件/软件组合，用于保护防火墙后网络上的所有计算机。
3. 应用程序防火墙保护对软件应用程序的网络访问。例如，Web应用程序防火墙[web application firewall（WAF）]专门用于保护组织的Web应用程序和其他基于应用程序的基础架构免受恶意流量的威胁。

有状态vs.无状态
^^^^^^^^^^^^^^^^^^^^^^^^^

防火墙可以是有状态或无状态的。无状态的防火墙（stateless firewall）在连接到防火墙时不会跟踪它的活动状态。因此，它根据与这个流量相关的一些静态值（如流量的目的地或源端口）来允许或阻止流量。因此，ACL在无状态防火墙决策中扮演着重要角色。有状态防火墙（stateful firewall）可以跟踪连接的活动状态，并能够根据与连接状态相关的网络数据包的内容做出决定。有状态防火墙通常比无状态防火墙更强大，但可能需要额外的开销。

Windows防火墙配置
----------------------------

Windows防火墙是一种基于软件的防火墙，包含在所有当前Windows操作系统客户端和服务器版本中。你可以使用高级安全性Windows防火墙控制台来监控控制进出系统信息流的规则，指定新规则，修改现有规则和删除规则。

你可以使用高级安全Windows防火墙控制台设置三种类型的防火墙规则：

* 入站规则：这些规则定义了防火墙对来自另一个系统的数据执行的操作。
* 出站规则：这些规则定义了防火墙对流出系统的数据执行的操作。
* 连接安全规则：这些规则定义了允许系统之间进行通讯所需的身份验证类型。

负载均衡器
----------------------

负载均衡器（load balancer）是一种将网络流量或计算工作量分配到网络中多个设备之间的网络设备。通过负载均衡设备之间的工作负载，网络中的所有设备都能更高效地运行。因此，单个设备地工作负荷也就不太可能出现过载地现象，这使得负载均衡成为一种防DDoS的安全控制。例如，单个负载均衡器可能有多个受其控制的Web服务器。Web客户端连接到负载均衡器的虚拟IP（单一公共IP地址），然后负载均衡器将流量转发到负载均衡器的一个或多个Web服务器。这样，就不会出现Web服务器被大量客户端流量淹没的情况。

负载均衡器使用不同的调度（scheduling）方法来确定将流量路由到哪些设备。例如，在轮询调度（round robin）方法中，负载均衡器有一个可以将流量转发到设备列表。负载均衡器会从上至下顺着列表将流量逐个转发到每个设备，直到它结束，然后循环并继续。在关联（affinity）调度模式下，负载均衡器会尝试将客户端的流量转发到客户端已与之建立连接的服务器。这种粘性功能旨在减少客户端与服务器之间的开放式网络连接数量。

冗余模式
^^^^^^^^^^^^^^^^^

除了分散工作负载以优化流量之外，负载均衡器还可以提供冗余。在主动——被动（active-passive）模式下，一个负载均衡器处理主要工作负载，而另一个负载均衡器处理待机状态。如果主负载均衡器发生故障，待机负载均衡器将接管并激活。在主动——被动（active-active）模式下，两个负载均衡器承担相同的工作负载部分。如果一个负载均衡器出现了故障，另一个将继续提供服务。

网络扫描器和分析工具
------------------------------

下表介绍了一些在网络中用于安全措施的扫描和分析工具。

.. csv-table:: 网络扫描器和分析工具
    :header: "网络工具", "描述"
    :widths: 5 30

    "数据包分析器（Packer analyzer）", "也称为嗅探器（sniffer），它是一种监视网络线路或无线网络上的网络通信并捕获数据的设备或程序。数据包分析器可用于通过检查其内容来收集通过网络传递的信息。"
    "协议分析器（Protocol analyzer）", "这种设备或程序使用数据包分析器捕获的数据来识别网络流量这在使用的协议和应用程序类型。协议分析器不仅关注流量的内容，还可以帮助揭示使用特定矢量的恶意流量。"
    "网络枚举器（networking enumerator）", "也称为网络映射器（network mapper），该设备或程序能够识别网络的逻辑拓扑以揭示其连接路径。这可以帮助你了解网络体系结构的高级概况，以识别潜在的薄弱点。"

.. note:: 一些软件工具将上述功能组合到单个应用程序中。因此，“数据分析器”和“协议分析器”通常可以互换使用。

入侵检测系统
-------------------

入侵检测系统（intrusion detection system/IDS）是一种可以扫描、评估和监控计算机基础设施，查找其中正在进行的攻击迹象的系统。IDS软件还可以分析数据并提醒安全管理员解决潜在的基础设施问题。IDS可以包含各种硬件传感器、入侵检测软件和IDS管理软件。每种实施方案都是独一无二的，取决于组织的安全需求和所选组件。

网路IDS
------------------

网络入侵检测系统[network intrusion detection system(NIDS)]是一种IDS，主要使用被动硬件传感器来监控网络特定部分的流量。它可以嗅探流量并发送关于异常或问题的警报。

NIDS的一个特别用途是流氓系统（rogue system）检测。流氓系统是连接到网络的任何未知或无法识别的设备，通常具有恶意的意图。通过使用各种技术来扫描可疑行为，NIDS可以发现流氓机器。

NIDS还可以发现在网络上执行的侦察尝试行为，例如，攻击者试图映射网络，识别特定网络后面的主机或扫描这些主机上的开放端口。NIDS还可以分析和识别已知的基于网络的攻击模式，如SYN泛洪或其他DDoS攻击。

无线IDS
^^^^^^^^^^^^^^^^^^

无线入侵检测系统[wireless intrusion detection(WIDS)]是一种NIDS，它扫描射频频谱以查找无线网络（主要是非法接入点）可能受到的威胁。WIDS可以比较充当接入点的设备的媒体访问控制（MAC）地址与已知地址，如果未找到匹配，则会发出警报。但是，MAC地址欺骗可能会使WIDS变得不再单纯有效。

基于主机的IDS
^^^^^^^^^^^^^^^^^^^^^^^

还可以将IDS设置为基于主机的入侵检测系统[host-based intrusion detection system(HIDS)]，它会监控计算机系统是否出现意外行为或系统状态是否发生剧烈变化。例如，HIDS可能包含文件完整性检查功能，已检测主机上的数据是否被意外修改。

入侵防御系统
-------------------

入侵防御系统[intrusion prevention system(IPS)]具有IDS的监控能力，但它也可以主动阻止检测到的威胁。这使得IPS可以采取必要的额外步骤来防止入侵系统。你可以配置IPS自动对特定威胁做出反应，同时继续对其他事件使用被动响应。

尽管IPS可以通过立即阻止恶意流量来提供网络防御优势，而不是等待IT人员响应警报，但使用IPS还是有一些缺陷的。IDS/IPS分析揭示了一个重要信息，监控系统容易受到误报的影响。与IDS不同，遇到误报的IPS会立即采取行动阻止被误认为是恶意的行为。在这种情况发生之前，IT人员将不会有机会对该情况进行他们自己的人为判断，这可能会产生重大后果。即使是漏报——系统误认为行为是合法的——也会产生不必要的后果。如果过度依赖自动化系统来完成保护组织的所有工作，那么漏报可能会让你陷入虚假的安全感。

尽管如此，一个管理良好且精心调整的IPS可以成为防御入侵的有力工具。

网络IPS
-------------------

网络入侵防御系统[netwrok intrusion prevention system(NIPS)]监控网络上的可疑流量并实时作出反应以阻止流量。阻止可能丢弃不需要的数据包或重置连接。使用NIPS的一个优点就是它可以根据特定内容来调节流量，因为它可以根据特定内容来调节流量，因为它可以在数据包穿过网段时对其进行检查。这与无状态防火墙的行为方式相反，无状态防火墙阻止了IP地址或整个端口，而不考虑流量的内容。

无线IPS
--------------------

无线入侵防御系统[wireless intrusion prevention(WIPS)]是一种NIPS，可扫描射频频谱以查找无线网络（主要是非法接入点）可能受到威胁，并可主动阻止此恶意流量。像NIPS一样，WIPS可以在数据包通过网络时实时丢弃不需要的数据包。

网络监控系统的类型
---------------------------

下表描述了可以使用的IDS/IPS进行监控网络的各种方法。

.. csv-table:: 网络监控系统
    :header: "监控系统", "描述"
    :widths: 5 30

    "基于签名的监控", "该系统使用由软件供应商或安全人员提供的一组预定义规划来识别不可接受的事件。不可接收的事件具有特定的已知特征，如端口扫描是如何完成系统上每个开放端口的TCP握手，然后立即关闭TCP连接的。"
    "基于异常的监控", "该系统定义了事件的预期结果或模式，然后识别不遵循这些模式的任何事件。与标准偏离明显的事件可能被认定为异常事件。因此，这种类型的监控需要预先配置可接受事件的基线。"
    "基于行为的监控", "该系统确定实体的表现方式，然后审查未来的行为以查看它是否偏离了常态。行为分析与异常分析的不同之处在于，后者规定了预期模式的基线，而前者记录了对被监控实体做出对应的预期模式。"
    "启发式监控", "该系统确定实体在特定环境中的行为方式，并据此确定实体的性质。启发式系统可能会推断出特定实体是否会对环境构成威胁，并根据得出的结论做出相应反应。"

传感器类型
--------------------

用于入侵检测/预防的监控传感器主要有两种工作方式：内联和被动，也称为带内与带外。内联传感器被放置在网段内，使得流量必须在达到目的地之前通过监控系统。这可以在造成任何可能伤害之前系统立即阻止可疑流量，如IPS。但是，被动传感器智能接收穿过网段的流量副本。由于它们不直接处理发送给网段主机的流量，因此使得被动传感器称为IDS配置的理想选择。

安全信息和事件处理
-----------------------------

安全信息和事件管理[Security information and event management(SIEM)]解决方案可对网络硬件和应用程序生成的安全报警提供实时或接近实时的分析。通过安全数据的汇总和关联，SIEM技术经常被用来提供对入侵检测和预防的深入了解。SIEM方案可以以软件、硬件设备或云服务的形式进行实施。

SIEM解决方案可以从各种各样的来源获取安全数据，但通常情况下会从工作站、服务器、网络交换机和路由器、防火墙、IDS\IPS以及几乎所有其他联网系统中提取日志文件。汇总过程可确保尽可能多的相关日志文件按需加载到SIEM中。这样，安全人员就可以更全面地了解网络中的活动，而不是仅仅在没有足够上下文的情况下凭空查看每个单独的日志文件。同样，关联流程确保了不同系统的相关事件可以被放置在相同环境中。

SIEM的一些其他功能包括：

* 自动报警。设置SIEM，以便特定事件触发器被激活时，会提示SIEM自动将报警信息发送给相关安全人员。
* 时间同步。作为关联过程的一部分，SIEM被配置为同步所有相关事件的时间戳，以便可以显现更清晰的网络活动图像。这使得完全人员能建立精确的事件事件表。
* 删除重复事件（deduplication）。由不同系统记录的一些事件最终可能为安全人员提供了相同的确切信息。为消除冗余信息并简化事件审查，一些SIEM可以删除重复的条目。
* 一次写入多次读取[Write once read many(WORM)]功能。为了帮助维护安全数据的完整性，将数据推送到SIEM的系统可以将日志文件存储在WORM存储介质上。这确保了一旦写入数据，就不能被修改——只能读取（在这种情况下，由SIEM进行读取。）

数据丢失/泄露防御
--------------------------------

数据丢失/泄露防御[Data loss/leak prevention(DLP)]是一种软件解决方案，可以检测和防止系统或网络中的敏感信息被盗或以其他方式落入不法之徒手中。该软件主动监控数据并检测任何未经授权的破坏、移动或复制数据的尝试行为。如果检测到任何可疑活动，某些DLP软件就能以特定方式阻止用户与数据交互。例如，你可以在组织的网络上安全DLP系统，检测通过电子邮件发送机密文件的任何尝试，然后阻止该电子邮件到达目的地。在这方面，数据丢失预防与入侵检测/防御系统的目标相反：DLP软件不关注入站攻击的防御，而是保护出站数据。

虽然DLP经常被视为网络安全解决方案，但它也可以在主机保护层面上运行。例如，假设用户知道用于出站电子邮件的DLP保护，但仍然解决从内部网络中删除机密文件。如果它们能访问文件所在的主机，就可以插入USB驱动器，将数据复制到该驱动器，然后拔下驱动器并将其从本地中物理移除。但是，基于主机的DLP方案可以实现USB的阻止功能，使整个USB协议在系统上不可用，或使受保护的特定文件无法从系统存储中读取并写入USB驱动器。

与许多其他安全设备一样，DLP方案可以通过软件、硬件或基于云来实现。

数据丢失 vs. 泄露
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

虽然数据丢失和数据泄露是相关联的，但它们并不完全相同。泄露的数据会被传输给未经授权的人员，但仍可能以原始形式存在于原始位置。丢失的数据可能会也可能不会传递给未授权用户，但不管哪种方式都不会再属于其拥有者。

虚拟私有网络
------------------------------

虚拟私有网络[virtual private network(VPN)]是通过在公网网络（例如互联网）上建立隧道来扩展专用网络的方法。通过使用隧道来封装和加密数据，VPN可在端点（如路由器，客户端或服务器）之间提供安全连接。需要使用特殊的VPN协议来提供VPN隧道、安全和数据加密服务。

VPN集中器
-------------------

VPN集中器（VPN concentrator）是包含了高级加密和认证方式的一种单一设备，以便能够处理大量的VPN隧道。它专门针对安全远程访问或站点到站点的VPN。远程访问VPN连接个人远程用户和私有网络，而站点到站点的VPN将两个专用网络连接在一起。在传统的远程访问VPN设置中，用户必须手动地启动VPN连接。但是，某些VPN集中器支持始终在线的功能，因此用户的设备能在任何连接到Internet时自动连接到VPN。这简化了远程连接过程，并确保设备上的所有Internet通讯都被加密。

.. note:: 始终在线VPN服务的一个例子就是微软的DirectAccess技术。

VPN和VPN集中器可以使用几种不同的隧道协议来提供安全的传输。站点到站点连接最主要的一个协议就是IPSec，它具备对通过网络传输的数据包进行认证和加密功能。SSL/TLS也被用作VPN的身份验证和加密协议，主要用于远程访问连接。

VPN集中器提供高性能，高可用性和惊人的可扩展性。

分离隧道 vs. 完整隧道
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

VPN隧道可以被配置为分离模式或完整模式。在完整模式下，当设备连接到VPN时，所有网络流量都将通过隧道发送并加密。在分离模式下，只有部分流量通过隧道发送并加密。在大多数情况下，专用于私有网络的流量（例如，访问组织的文件共享）通过隧道发送，而不相关的互联网流量（例如网页浏览，网络邮件等）仅通过设备自己的网关，而不是通过隧道发送。

分离隧道的主要优点是私有网络不需要处理尽可能多的带宽。主要缺点是组织无法控制用户的互联网绑定流量。例如，如果用户将敏感数据传输到未加密网站上，那么该数据可能容易受到中间人攻击。

安全网关
--------------------------

充当安全网关的设备确保在网络流量离开私有网络并移动到公共网络之前（或者相反），将一些安全控制应用于网络流量。网关可以在流量中应用几种不同的安全控制。例如，邮件网关倾向于关注防止那些通过电子邮件进入或离开网络的安全威胁。垃圾邮件过滤器（Spam filter）可以读取并拒绝某些基于Internet的入站邮件，这些邮件中包含了已知垃圾邮件中使用的目标单词和短语。DLP方案可以防止员工或内部威胁通过电子邮件将敏感数据泄露到外部世界。安全网关还可以在电子邮件离开网络时加密它们的传输，以维护邮件内容的完整性和机密性。

其中一些相同的安全控制措施，特别是加密和DLP技术，可以应用于除电子邮件以外更多其他流量。在不同类型的网络之间转换流媒体的媒体网关可能包含组织希望保持其安全性的语音通讯或知识产权。

统一威胁管理
--------------------

统一威胁管理[Unified threat management(UTM)]是指将各种安全技术（防火墙、防恶意软件、网络入侵防御、垃圾邮件过滤、内容检查等）集中 到一台设备中的系统。另外，UTM安全设备通常包含一个控制台，安全管理员可以从中监控和管理各种防御设置。UTM的创建是为了响应管理员在部署分离式安全系统时遇到的许多困难；就是在管理几个复杂平台的同时需要满足重要的成本要求。

UTM系统有助于简化安全过程，因为它只需要与一个供应商绑定，只需要使用一个简化应用程序就能运行。这使得组织的网络安全管理变得更加容易，因为您不再需要熟悉或了解每个安全实施的独特问题。

尽管如此，UTM也有其不足之处。当防御功能被统一到单一系统中时，就创造了可能影响整个网络的单点故障。不同的安全系统如果失败，可能只会受到特定攻击途径的威胁。另外，如果UTM系统受到太多网络活动的影响，可能会遇到延迟问题。

配置网络安全技术的准则
------------------------------

配置网络安全技术时：

* 熟悉构成网络的常见设备，以及每种设备的特定安全问题。
* 实施协议和数据包分析器等网络扫描技术，以及时了解网络中的流量状态。
* 实施网络入侵检测系统，以帮助你识别不需要的网络行为。
* 了解使用主动入侵防御设备的风险，特别是误报。
* 考虑将SIEM技术结合到组织中以汇总和关联网络事件数据。
* 考虑实施DLP解决方案以防止敏感数据的意外丢失或泄露。
* 实施VPN技术，以支持私有网络和公共网络之间的身份验证和加密访问。
* 考虑在更复杂的环境中使用VPN集中器，特别是在站点到站点的连接中。
* 考虑为连接到VPN的客户端使用始终在线的功能。
* 将安全网关应用到网络中，以便更好地控制进出私有网络的流量状态。
* 考虑使用UTM来简化网络安全设备的管理。
* 了解UTM涉及的风险，尤其是因为它可能成为一个单点故障。
